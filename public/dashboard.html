<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureScope - Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-sm">üõ°Ô∏è</div>
                <h2>SecureScope</h2>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Hauptmen√º</div>
                    <div class="nav-item active" data-view="dashboard" onclick="switchView('dashboard')">
                        <i class="bi bi-grid-1x2"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" data-view="new-scan" onclick="switchView('new-scan')">
                        <i class="bi bi-search"></i>
                        <span>Neuer Scan</span>
                    </div>
                    <div class="nav-item" data-view="history" onclick="switchView('history')">
                        <i class="bi bi-clock-history"></i>
                        <span>Scan-Historie</span>
                    </div>
                    <div class="nav-item" data-view="compare" onclick="switchView('compare')">
                        <i class="bi bi-arrow-left-right"></i>
                        <span>Vergleich</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <div class="nav-item" onclick="showPasswordModal()">
                        <i class="bi bi-key"></i>
                        <span>Passwort √§ndern</span>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="username" id="sidebarUsername">Admin</div>
                        <div class="role">Administrator</div>
                    </div>
                    <button class="btn-icon btn-outline" onclick="logout()" title="Abmelden">
                        <i class="bi bi-box-arrow-right"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="topbar">
                <div class="d-flex align-center gap-1">
                    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
                        <i class="bi bi-list"></i>
                    </button>
                    <h1 id="viewTitle">Dashboard</h1>
                </div>
                <div class="topbar-actions">
                    <button class="theme-toggle" onclick="toggleTheme()" title="Theme wechseln">
                        <i class="bi bi-moon-stars" id="themeIcon"></i>
                    </button>
                </div>
            </div>

            <!-- ============================================ -->
            <!-- VIEW: Dashboard Overview -->
            <!-- ============================================ -->
            <section class="view-section active" id="view-dashboard">
                <!-- Stats -->
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-icon blue"><i class="bi bi-search"></i></div>
                        <div class="stat-info">
                            <h4>Scans Gesamt</h4>
                            <div class="stat-value" id="statTotalScans">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green"><i class="bi bi-check-circle"></i></div>
                        <div class="stat-info">
                            <h4>Abgeschlossen</h4>
                            <div class="stat-value" id="statCompleted">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red"><i class="bi bi-exclamation-triangle"></i></div>
                        <div class="stat-info">
                            <h4>Kritische Ports</h4>
                            <div class="stat-value" id="statCritical">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple"><i class="bi bi-activity"></i></div>
                        <div class="stat-info">
                            <h4>Aktive Scans</h4>
                            <div class="stat-value" id="statActive">0</div>
                        </div>
                    </div>
                </div>

                <!-- Active Scan Status -->
                <div id="activeScanPanel" class="hidden mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="bi bi-broadcast mr-1"></i> Laufender Scan</h3>
                            <button class="btn btn-danger btn-sm" id="stopActiveScanBtn" onclick="stopActiveScan()">
                                <i class="bi bi-stop-circle"></i> Abbrechen
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="scan-running-indicator">
                                <div class="scan-pulse"></div>
                                <span id="activeScanInfo">Scan l√§uft...</span>
                            </div>
                            <div class="progress-container">
                                <div class="progress-bar-wrapper">
                                    <div class="progress-bar animated" id="activeScanProgress" style="width: 0%"></div>
                                </div>
                                <div class="progress-text">
                                    <span id="activeScanProgressText">0%</span>
                                    <span id="activeScanTarget"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Scans -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="bi bi-clock-history mr-1"></i> Letzte Scans</h3>
                        <button class="btn btn-outline btn-sm" onclick="switchView('new-scan')">
                            <i class="bi bi-plus"></i> Neuer Scan
                        </button>
                    </div>
                    <div class="card-body" id="recentScansBody">
                        <div class="loading-overlay" id="recentScansLoading">
                            <div class="spinner spinner-lg spinner-blue"></div>
                            <span>Lade Daten...</span>
                        </div>
                        <div class="table-container hidden" id="recentScansTable">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Ziel</th>
                                        <th>Typ</th>
                                        <th>Status</th>
                                        <th>Ergebnisse</th>
                                        <th>Datum</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="recentScansTableBody">
                                </tbody>
                            </table>
                        </div>
                        <div class="empty-state hidden" id="recentScansEmpty">
                            <i class="bi bi-inbox"></i>
                            <h4>Keine Scans vorhanden</h4>
                            <p>Starten Sie Ihren ersten Netzwerk-Scan, um Ergebnisse zu sehen.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================ -->
            <!-- VIEW: New Scan -->
            <!-- ============================================ -->
            <section class="view-section" id="view-new-scan">
                <div class="card mb-3">
                    <div class="card-header">
                        <h3><i class="bi bi-search mr-1"></i> Scan konfigurieren</h3>
                    </div>
                    <div class="card-body">
                        <form id="scanForm" onsubmit="startScan(event)">
                            <div class="scan-config">
                                <div class="form-group">
                                    <label for="scanTarget">Ziel (IP-Adresse)</label>
                                    <input type="text" id="scanTarget" class="form-control" placeholder="z.B. 192.168.1.1" required>
                                    <small class="text-muted mt-1" style="display:block; font-size: 0.75rem;">Einzelne IP oder CIDR-Notation (z.B. 192.168.1.0/24)</small>
                                </div>
                                <div class="form-group">
                                    <label for="scanType">Scan-Typ</label>
                                    <select id="scanType" class="form-control" onchange="toggleCustomPorts()">
                                        <option value="quick">Quick Scan (Top 100 Ports)</option>
                                        <option value="standard" selected>Standard Scan (Top 1000 Ports)</option>
                                        <option value="full">Full Scan (alle 65535 Ports)</option>
                                        <option value="custom">Custom Ports</option>
                                    </select>
                                </div>
                                <div class="form-group full-width hidden" id="customPortsGroup">
                                    <label for="customPorts">Benutzerdefinierte Ports</label>
                                    <input type="text" id="customPorts" class="form-control" placeholder="z.B. 22,80,443,3389 oder 1-1024">
                                    <small class="text-muted mt-1" style="display:block; font-size: 0.75rem;">Kommagetrennte Ports oder Bereiche (z.B. 22,80,443 oder 1-1024)</small>
                                </div>
                                <div class="full-width">
                                    <div id="scanWarning" class="hidden" style="padding: 0.75rem 1rem; background: var(--accent-yellow-bg); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: var(--radius-sm); margin-bottom: 1rem; font-size: 0.875rem; color: var(--accent-yellow);">
                                        <i class="bi bi-exclamation-triangle mr-1"></i>
                                        <span id="scanWarningText"></span>
                                    </div>
                                    <button type="submit" id="startScanBtn" class="btn btn-primary btn-lg">
                                        <i class="bi bi-play-fill"></i>
                                        <span id="startScanBtnText">Scan starten</span>
                                        <span id="startScanSpinner" class="spinner hidden"></span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Scan Progress & Results -->
                <div id="scanProgressPanel" class="hidden">
                    <div class="card mb-3">
                        <div class="card-header">
                            <h3><i class="bi bi-broadcast mr-1"></i> Scan-Fortschritt</h3>
                            <button class="btn btn-danger btn-sm" id="stopScanBtn" onclick="stopCurrentScan()">
                                <i class="bi bi-stop-circle"></i> Abbrechen
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="scan-running-indicator" id="scanRunningIndicator">
                                <div class="scan-pulse"></div>
                                <span id="scanProgressInfo">Scan wird gestartet...</span>
                            </div>
                            <div class="progress-container">
                                <div class="progress-bar-wrapper">
                                    <div class="progress-bar animated" id="scanProgressBar" style="width: 0%"></div>
                                </div>
                                <div class="progress-text">
                                    <span id="scanProgressPercent">0%</span>
                                    <span id="scanProgressDetail"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scan Results -->
                <div id="scanResultsPanel" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="bi bi-table mr-1"></i> Scan-Ergebnisse</h3>
                            <div class="d-flex gap-1">
                                <button class="btn btn-outline btn-sm" onclick="exportResults('csv')">
                                    <i class="bi bi-filetype-csv"></i> CSV
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportResults('json')">
                                    <i class="bi bi-filetype-json"></i> JSON
                                </button>
                                <button class="btn btn-outline btn-sm" onclick="exportResults('pdf')">
                                    <i class="bi bi-filetype-pdf"></i> PDF
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Results Summary -->
                            <div class="stats-grid mb-3" id="resultsSummary">
                                <div class="stat-card">
                                    <div class="stat-icon blue"><i class="bi bi-hdd-network"></i></div>
                                    <div class="stat-info">
                                        <h4>Offene Ports</h4>
                                        <div class="stat-value" id="resultTotal">0</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon red"><i class="bi bi-shield-x"></i></div>
                                    <div class="stat-info">
                                        <h4>Kritisch</h4>
                                        <div class="stat-value" id="resultCritical">0</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon yellow"><i class="bi bi-shield-exclamation"></i></div>
                                    <div class="stat-info">
                                        <h4>Warnung</h4>
                                        <div class="stat-value" id="resultWarning">0</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon green"><i class="bi bi-shield-check"></i></div>
                                    <div class="stat-info">
                                        <h4>Sicher</h4>
                                        <div class="stat-value" id="resultSafe">0</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Results Table -->
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>IP-Adresse</th>
                                            <th>Port</th>
                                            <th>Protokoll</th>
                                            <th>Service</th>
                                            <th>Status</th>
                                            <th>Risiko</th>
                                        </tr>
                                    </thead>
                                    <tbody id="resultsTableBody">
                                    </tbody>
                                </table>
                            </div>
                            <div class="empty-state hidden" id="resultsEmpty">
                                <i class="bi bi-shield-check"></i>
                                <h4>Keine offenen Ports gefunden</h4>
                                <p>Der Scan hat keine offenen Ports im angegebenen Bereich gefunden.</p>
                            </div>
                            <!-- Pagination -->
                            <div id="resultsPagination" class="hidden">
                                <div class="pagination" id="resultsPaginationBtns"></div>
                                <div class="pagination-info" id="resultsPaginationInfo"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================ -->
            <!-- VIEW: Scan History -->
            <!-- ============================================ -->
            <section class="view-section" id="view-history">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="bi bi-clock-history mr-1"></i> Scan-Historie</h3>
                    </div>
                    <div class="card-body">
                        <!-- Filters -->
                        <div class="filters-bar">
                            <div class="form-group">
                                <label>Von</label>
                                <input type="date" id="filterDateFrom" class="form-control" onchange="loadHistory()">
                            </div>
                            <div class="form-group">
                                <label>Bis</label>
                                <input type="date" id="filterDateTo" class="form-control" onchange="loadHistory()">
                            </div>
                            <div class="form-group">
                                <label>Scan-Typ</label>
                                <select id="filterScanType" class="form-control" onchange="loadHistory()">
                                    <option value="">Alle</option>
                                    <option value="quick">Quick</option>
                                    <option value="standard">Standard</option>
                                    <option value="full">Full</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="filterStatus" class="form-control" onchange="loadHistory()">
                                    <option value="">Alle</option>
                                    <option value="completed">Abgeschlossen</option>
                                    <option value="running">Laufend</option>
                                    <option value="failed">Fehlgeschlagen</option>
                                    <option value="aborted">Abgebrochen</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ziel</label>
                                <input type="text" id="filterTarget" class="form-control" placeholder="IP suchen..." oninput="debounce(loadHistory, 500)()">
                            </div>
                        </div>

                        <!-- History Table -->
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Ziel</th>
                                        <th>Typ</th>
                                        <th>Status</th>
                                        <th>Ergebnisse</th>
                                        <th>Gestartet</th>
                                        <th>Dauer</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTableBody">
                                </tbody>
                            </table>
                        </div>
                        <div class="empty-state hidden" id="historyEmpty">
                            <i class="bi bi-inbox"></i>
                            <h4>Keine Scans gefunden</h4>
                            <p>Es wurden keine Scans gefunden, die Ihren Filterkriterien entsprechen.</p>
                        </div>
                        <div class="loading-overlay hidden" id="historyLoading">
                            <div class="spinner spinner-lg spinner-blue"></div>
                            <span>Lade Historie...</span>
                        </div>
                        <!-- Pagination -->
                        <div id="historyPagination" class="hidden">
                            <div class="pagination" id="historyPaginationBtns"></div>
                            <div class="pagination-info" id="historyPaginationInfo"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================ -->
            <!-- VIEW: Compare Scans -->
            <!-- ============================================ -->
            <section class="view-section" id="view-compare">
                <div class="card mb-3">
                    <div class="card-header">
                        <h3><i class="bi bi-arrow-left-right mr-1"></i> Scans vergleichen</h3>
                    </div>
                    <div class="card-body">
                        <div class="scan-config">
                            <div class="form-group">
                                <label for="compareScan1">Scan 1 (ID)</label>
                                <input type="number" id="compareScan1" class="form-control" placeholder="Scan-ID eingeben" min="1">
                            </div>
                            <div class="form-group">
                                <label for="compareScan2">Scan 2 (ID)</label>
                                <input type="number" id="compareScan2" class="form-control" placeholder="Scan-ID eingeben" min="1">
                            </div>
                            <div class="full-width">
                                <button class="btn btn-primary" onclick="compareScans()">
                                    <i class="bi bi-arrow-left-right"></i> Vergleichen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Results -->
                <div id="comparisonResults" class="hidden">
                    <!-- Summary -->
                    <div class="stats-grid mb-3">
                        <div class="stat-card">
                            <div class="stat-icon green"><i class="bi bi-plus-circle"></i></div>
                            <div class="stat-info">
                                <h4>Neue Ports</h4>
                                <div class="stat-value" id="compareNew">0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon red"><i class="bi bi-dash-circle"></i></div>
                            <div class="stat-info">
                                <h4>Geschlossene Ports</h4>
                                <div class="stat-value" id="compareClosed">0</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon blue"><i class="bi bi-arrow-repeat"></i></div>
                            <div class="stat-info">
                                <h4>Unver√§ndert</h4>
                                <div class="stat-value" id="compareUnchanged">0</div>
                            </div>
                        </div>
                    </div>

                    <div class="comparison-grid">
                        <!-- Only in Scan 2 (New) -->
                        <div class="card comparison-new">
                            <div class="card-header">
                                <h3 class="text-success"><i class="bi bi-plus-circle mr-1"></i> Nur in Scan 2 (Neu)</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr><th>IP</th><th>Port</th><th>Service</th><th>Risiko</th></tr>
                                        </thead>
                                        <tbody id="compareNewBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Only in Scan 1 (Removed) -->
                        <div class="card comparison-removed">
                            <div class="card-header">
                                <h3 class="text-danger"><i class="bi bi-dash-circle mr-1"></i> Nur in Scan 1 (Geschlossen)</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr><th>IP</th><th>Port</th><th>Service</th><th>Risiko</th></tr>
                                        </thead>
                                        <tbody id="compareRemovedBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ============================================ -->
            <!-- VIEW: Scan Detail (dynamically shown) -->
            <!-- ============================================ -->
            <section class="view-section" id="view-scan-detail">
                <div class="d-flex align-center gap-1 mb-3">
                    <button class="btn btn-outline btn-sm" onclick="goBackFromDetail()">
                        <i class="bi bi-arrow-left"></i> Zur√ºck
                    </button>
                    <h3 id="scanDetailTitle">Scan Details</h3>
                </div>

                <div class="card mb-3">
                    <div class="card-header">
                        <h3><i class="bi bi-info-circle mr-1"></i> Scan-Informationen</h3>
                        <div class="d-flex gap-1">
                            <button class="btn btn-outline btn-sm" onclick="exportDetailResults('csv')">
                                <i class="bi bi-filetype-csv"></i> CSV
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportDetailResults('json')">
                                <i class="bi bi-filetype-json"></i> JSON
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="exportDetailResults('pdf')">
                                <i class="bi bi-filetype-pdf"></i> PDF
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="scan-config" style="gap: 0.5rem;">
                            <div><strong>ID:</strong> <span id="detailId" class="text-mono"></span></div>
                            <div><strong>Ziel:</strong> <span id="detailTarget" class="text-mono"></span></div>
                            <div><strong>Typ:</strong> <span id="detailType"></span></div>
                            <div><strong>Status:</strong> <span id="detailStatus"></span></div>
                            <div><strong>Gestartet:</strong> <span id="detailStarted"></span></div>
                            <div><strong>Abgeschlossen:</strong> <span id="detailCompleted"></span></div>
                        </div>
                    </div>
                </div>

                <!-- Detail Results Summary -->
                <div class="stats-grid mb-3" id="detailSummary"></div>

                <!-- Detail Results Table -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="bi bi-table mr-1"></i> Ergebnisse</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>IP-Adresse</th>
                                        <th>Port</th>
                                        <th>Protokoll</th>
                                        <th>Service</th>
                                        <th>Status</th>
                                        <th>Risiko</th>
                                    </tr>
                                </thead>
                                <tbody id="detailResultsBody"></tbody>
                            </table>
                        </div>
                        <div class="empty-state hidden" id="detailResultsEmpty">
                            <i class="bi bi-shield-check"></i>
                            <h4>Keine Ergebnisse</h4>
                        </div>
                        <div id="detailPagination" class="hidden">
                            <div class="pagination" id="detailPaginationBtns"></div>
                            <div class="pagination-info" id="detailPaginationInfo"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ============================================ -->
    <!-- Password Change Modal -->
    <!-- ============================================ -->
    <div class="modal-overlay hidden" id="passwordModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="bi bi-key mr-1"></i> Passwort √§ndern</h3>
                <button class="btn-icon btn-outline" onclick="hidePasswordModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="dashboardPwForm" onsubmit="changePassword(event)">
                    <div class="form-group">
                        <label>Aktuelles Passwort</label>
                        <input type="password" id="modalCurrentPw" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Neues Passwort</label>
                        <input type="password" id="modalNewPw" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Passwort best√§tigen</label>
                        <input type="password" id="modalConfirmPw" class="form-control" required>
                    </div>
                    <ul class="password-requirements">
                        <li>Mindestens 8 Zeichen</li>
                        <li>Gro√ü- und Kleinbuchstaben</li>
                        <li>Mindestens eine Zahl</li>
                    </ul>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="hidePasswordModal()">Abbrechen</button>
                <button class="btn btn-success" onclick="changePassword(event)">
                    <i class="bi bi-check-lg"></i> Speichern
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="js/dashboard.js"></script>
</body>
</html>